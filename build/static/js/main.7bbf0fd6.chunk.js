(this["webpackJsonpdemo20.reactredux2.ts"]=this["webpackJsonpdemo20.reactredux2.ts"]||[]).push([[0],{102:function(e,t,n){},103:function(e,t,n){},108:function(e,t,n){},128:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),u=n(61),c=n.n(u),o=(n(102),n(103),n(25)),s=function(){return a.a.createElement("div",null,a.a.createElement("nav",null,a.a.createElement("ul",null,a.a.createElement("li",null,a.a.createElement(o.b,{to:"/"},"Home")),a.a.createElement("li",null,a.a.createElement(o.b,{to:"/Page2"},"Page 2")),a.a.createElement("li",null,a.a.createElement(o.b,{to:"/Countries",className:"menu-countries"},"Countries")))))},i=n(5),l=(n(108),function(e){var t,n,r=Object(i.g)(),u=Object(i.h)();return a.a.createElement("header",{className:"App-header"},a.a.createElement("p",null,"Demo20 - React / Redux 2 with Typescript"),e.currentUserState.isAuthenticated?a.a.createElement("div",null,a.a.createElement("p",null,null===(t=e.currentUserState.user)||void 0===t?void 0:t.firstName," ",null===(n=e.currentUserState.user)||void 0===n?void 0:n.surname," is logged in"),a.a.createElement("button",{type:"button",className:"link-button",onClick:function(){e.clearCurrentUser(),r.push("/")}},"Log out")):a.a.createElement("button",{type:"button",className:"link-button",onClick:function(){r.push("/login",u.pathname)}},"Log in"),a.a.createElement(s,null))}),d=n(19),m=n(57),p=function(e,t){switch(t.type){case"SET":return localStorage.setItem("currentUser",JSON.stringify(t.payload.user)),Object(m.a)(Object(m.a)({},e),{},{isAuthenticated:t.payload.isAuthenticated,user:t.payload.user});case"CLEAR":return localStorage.removeItem("currentUser"),Object(m.a)(Object(m.a)({},e),{},{isAuthenticated:!1,user:null});default:throw new Error("Unhandled action type: ".concat(t.type))}};var f=function(){var e={isAuthenticated:!1,user:void 0},t=localStorage.getItem("currentUser");return t&&(e.isAuthenticated=!0,e.user=JSON.parse(t)),e}(),h=a.a.createContext(f),v=a.a.createContext(),b=function(e){var t=e.children,n=Object(r.useReducer)(p,f),u=Object(d.a)(n,2),c=u[0],o=u[1];return a.a.createElement(h.Provider,{value:c},a.a.createElement(v.Provider,{value:o},t))},E=function(){var e=a.a.useContext(h);if(void 0===e)throw new Error("useCurrentUserState must be used within a CurrentUserProvider");return e},y=function(){var e=a.a.useContext(v);if(void 0===e)throw new Error("useCurrentUserDispatch must be used within a CurrentUserProvider");return e},g=function(){var e=y(),t=E();return a.a.createElement(l,{clearCurrentUser:function(){e({type:"CLEAR"})},currentUserState:t})},w=n(96),C=function(){return a.a.createElement("div",null,"home")},S=function(){return a.a.createElement("div",null,"Page2")},j=n(2),O=n.n(j),x=n(4),k=function(e){return a.a.createElement("li",{className:"countries-item"},e.country.name," ",e.country.code)},A=n(95),U=function(e){var t=function(){var t=Object(x.a)(O.a.mark((function t(n){return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.addCountryWrapper(n);case 3:console.log(n),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),console.log(t.t0);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(e){return t.apply(this,arguments)}}(),n=Object(A.a)(),r=n.handleSubmit,u=n.register,c=n.errors,o=function(){var e=Object(x.a)(O.a.mark((function e(n){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return a.a.createElement("form",{onSubmit:r(o)},a.a.createElement("input",{name:"countryName",ref:u({required:"Required",validate:function(e){return e.length>2||"Country name must be at least three characters"}})}),c.countryName&&c.countryName.message,a.a.createElement("input",{name:"countryCode",ref:u({required:"Required",validate:function(e){return 3===e.length||"Country code must be three characters"}})}),c.countryCode&&c.countryCode.message,a.a.createElement("button",{type:"submit"},"Submit"),!!e.error&&a.a.createElement("p",{className:"error"},e.error),a.a.createElement("p",null,"Status: ",e.status))},N=n(24),P=n(53),q=n(55),R=n.n(q),L=n(89),B=n(90),H=function(){function e(){Object(L.a)(this,e),this.headers=void 0,this.headers={}}return Object(B.a)(e,[{key:"addAuthorizationHeader",value:function(e){return this.headers.Authorization="Bearer ".concat(e),this}}]),e}(),W={apiBaseUrl:"https://prod/api"},V=W.apiBaseUrl+"/countries",z=Object(P.b)("countries/fetch",function(){var e=Object(x.a)(O.a.mark((function e(t,n){var r,a,u;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.rejectWithValue,a=(new H).addAuthorizationHeader(t),e.prev=2,e.next=5,R()(V,a);case 5:return u=e.sent,e.abrupt("return",u.data);case 9:return e.prev=9,e.t0=e.catch(2),console.log(e.t0.response.data),e.abrupt("return",r(e.t0.response.data));case 13:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t,n){return e.apply(this,arguments)}}()),I=Object(P.b)("countries/add",function(){var e=Object(x.a)(O.a.mark((function e(t,n){var r,a,u,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.rejectWithValue,a={name:t.country.countryName,code:t.country.countryCode},u=(new H).addAuthorizationHeader(t.token),e.prev=3,e.next=6,R.a.post(V,a,u);case 6:return c=e.sent,e.abrupt("return",c.data);case 10:return e.prev=10,e.t0=e.catch(3),console.log(e.t0.response.data),e.abrupt("return",r(e.t0.response.data));case 14:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t,n){return e.apply(this,arguments)}}()),J=Object(P.c)({name:"countries",initialState:{list:[],addCountryStatus:"idle",fetchCountriesStatus:"idle"},reducers:{},extraReducers:function(e){e.addCase(z.pending,(function(e,t){e.fetchCountriesStatus="pending"})),e.addCase(z.fulfilled,(function(e,t){e.fetchCountriesStatus="succeeded",e.list=t.payload.countries})),e.addCase(z.rejected,(function(e,t){e.list=[],e.fetchCountriesStatus="failed",e.fetchCountriesError="Fetch countries failed"})),e.addCase(I.pending,(function(e,t){e.addCountryStatus="pending",e.addCountryError=void 0})),e.addCase(I.fulfilled,(function(e,t){e.list=e.list.concat(t.payload),e.list=e.list.sort((function(e,t){return e.name.localeCompare(t.name)})),e.addCountryStatus="succeeded",e.addCountryError=void 0})),e.addCase(I.rejected,(function(e,t){e.addCountryStatus="failed",e.addCountryError="Add country failed"}))}}).reducer,T=(N.c,function(e){var t,n=Object(N.b)(),r=Object(N.c)((function(e){return e.countries})),u=(r.list,r.addCountryStatus),c=r.addCountryError,o=(null===(t=E().user)||void 0===t?void 0:t.token)||"",s=function(){var e=Object(x.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n(I({country:t,token:o}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return a.a.createElement(U,{addCountryWrapper:s,status:u,error:c})}),F=function(e){return a.a.createElement("div",null,a.a.createElement("div",null,"There are ",e.countries.length," countries"),a.a.createElement("ul",{className:"countries-list"},0===(t=e.countries).length?"Loading...":t.map((function(e){return a.a.createElement(k,{key:e.id,country:e})}))),a.a.createElement("p",null,"Add country"),a.a.createElement(T,{countries:e.countries}));var t},D=function(){var e,t=Object(N.b)(),n=Object(N.c)((function(e){return e.countries})),u=n.list,c=n.fetchCountriesStatus,o=n.fetchCountriesError,s=(null===(e=E().user)||void 0===e?void 0:e.token)||"";return Object(r.useEffect)((function(){(function(){var e=Object(x.a)(O.a.mark((function e(n){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{t(z(n)),console.log("fetched countries")}catch(r){console.log("error: "+r.message)}case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}})()(s)}),[s,t]),a.a.createElement(a.a.Fragment,null,!!o&&a.a.createElement("p",{className:"error"},o),a.a.createElement("p",null,"Status: ",c),a.a.createElement(F,{countries:u||[]}))},M=n(58),$=function(e,t,n,r,a){t(n),e.setSubmitting(!1),e.setStatus({}),e.resetForm();var u=a.state||"/";r.push(u)},G=function(e,t){e.setSubmitting(!1);e.setStatus({msg:"Login failed"}),console.log("Login failed")},K=function(e){var t=Object(i.g)(),n=Object(i.h)();return a.a.createElement(M.c,{initialValues:e.initialValues,validationSchema:e.validationSchema,onSubmit:function(){var r=Object(x.a)(O.a.mark((function r(a,u){var c;return O.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.loginHandler(a);case 3:c=r.sent,$(u,e.setCurrentUser,c,t,n),r.next=10;break;case 7:r.prev=7,r.t0=r.catch(0),G(u,r.t0);case 10:case"end":return r.stop()}}),r,null,[[0,7]])})));return function(e,t){return r.apply(this,arguments)}}()},(function(e){var t=e.errors,n=e.status,r=e.touched,u=e.isSubmitting;return a.a.createElement(M.b,null,a.a.createElement("div",null,"Username: ",a.a.createElement(M.a,{type:"text",name:"username",className:"username"}),t.username&&r.username&&a.a.createElement("div",null,t.username)),a.a.createElement("div",null,"Password: ",a.a.createElement(M.a,{type:"text",name:"password",className:"password"}),t.password&&r.password&&a.a.createElement("div",null,t.password)),n&&n.msg&&a.a.createElement("div",null,n.msg),a.a.createElement("button",{type:"submit",disabled:u,className:"submit"},"Submit"))}))},Q=n(74),X=function(){var e=Object(x.a)(O.a.mark((function e(t){var n,r,a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=W.apiBaseUrl+"/token",r={username:t.username,password:t.password},e.next=4,R.a.post(n,r);case 4:return a=e.sent,e.abrupt("return",a.data);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Y={username:"",password:""},Z=Q.a().shape({username:Q.b().required("username is required"),password:Q.b().required("password is required")}),_=function(){var e=y();return a.a.createElement(K,{loginHandler:X,setCurrentUser:function(t){e({type:"SET",payload:{isAuthenticated:!0,user:t}})},initialValues:Y,validationSchema:Z})},ee=function(e){var t=e.isAllowed,n=e.pathname,r=Object(w.a)(e,["isAllowed","pathname"]);return t?a.a.createElement(i.b,r):a.a.createElement(i.a,{to:{pathname:"/login",state:n||"/"}})},te=function(){var e=E(),t=Object(i.h)();return a.a.createElement(i.d,null,a.a.createElement(i.b,{path:"/login",component:_}),a.a.createElement(ee,{path:"/countries",component:D,isAllowed:e.isAuthenticated,pathname:t.pathname}),a.a.createElement(i.b,{exact:!0,path:"/Page2",component:S}),a.a.createElement(i.b,{exact:!0,path:"/",component:C}))},ne=function(){return a.a.createElement(b,null,a.a.createElement(o.a,null,a.a.createElement("div",{className:"App"},a.a.createElement(g,null),a.a.createElement(te,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var re=n(22),ae=n(94),ue=n.n(ae),ce=Object(re.c)({countries:J}),oe=Object(P.a)({reducer:ce,middleware:function(e){return e().concat(ue.a)}});c.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(N.a,{store:oe},a.a.createElement(ne,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},97:function(e,t,n){e.exports=n(128)}},[[97,1,2]]]);
//# sourceMappingURL=main.7bbf0fd6.chunk.js.map